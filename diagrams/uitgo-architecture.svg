<svg xmlns="http://www.w3.org/2000/svg" width="2560" height="1440" viewBox="0 0 2560 1440" fill="none">
  <defs>
    <style>
      .card { rx: 18; ry: 18; fill: #ffffff; filter: url(#shadow); }
      .heading { font-family: "Arial", sans-serif; font-weight: 700; font-size: 22px; letter-spacing: 0.2px; }
      .label { font-family: "Arial", sans-serif; font-size: 18px; }
      .small { font-family: "Arial", sans-serif; font-size: 16px; }
      .mono { font-family: "Courier New", monospace; font-size: 16px; }
    </style>
    <linearGradient id="topBand" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#fff5ef"/>
      <stop offset="1" stop-color="#fff"/>
    </linearGradient>
    <linearGradient id="midBand" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#eef5ff"/>
      <stop offset="1" stop-color="#fff"/>
    </linearGradient>
    <linearGradient id="botBand" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0" stop-color="#f7f5ff"/>
      <stop offset="1" stop-color="#fff"/>
    </linearGradient>
    <filter id="shadow" x="-10" y="-10" width="200" height="200" filterUnits="userSpaceOnUse">
      <feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="#1f293733" />
    </filter>
    <marker id="arrowSolid" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M0,0 L12,6 L0,12 z" fill="#1f2937"/>
    </marker>
    <marker id="arrowDotted" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M0,0 L12,6 L0,12 z" fill="#2563eb"/>
    </marker>
  </defs>

  <!-- Background bands -->
  <rect x="40" y="70" width="2080" height="320" rx="24" fill="url(#topBand)" stroke="#ffd8bf" stroke-width="2"/>
  <rect x="40" y="410" width="2080" height="340" rx="24" fill="url(#midBand)" stroke="#bfdbfe" stroke-width="2"/>
  <rect x="40" y="770" width="2080" height="560" rx="24" fill="url(#botBand)" stroke="#e5e7eb" stroke-width="2"/>

  <!-- Title -->
  <text x="1040" y="40" class="heading" font-size="30" text-anchor="middle" fill="#111827">UITGO – CI/CD + GitOps + k3s Local Dev Architecture</text>
  <text x="1040" y="65" class="small" text-anchor="middle" fill="#6b7280">Flutter (iOS/Android/Web) • Go Microservices • GHCR • GitHub Actions + Kustomize • Argo CD • Traefik Ingress • Observability</text>

  <!-- Right lane: Client Apps -->
  <rect x="2160" y="90" width="320" height="640" rx="18" fill="#ffffff" stroke="#d1d5db" stroke-width="2" class="card"/>
  <text x="2320" y="130" class="heading" text-anchor="middle" fill="#111827">Client Apps</text>
  <text x="2320" y="165" class="label" text-anchor="middle" fill="#6b7280">Flutter 3.x / Dart 3.x</text>
  <text x="2320" y="190" class="label" text-anchor="middle" fill="#6b7280">Material 3 • iOS/Android/Web</text>
  <rect x="2220" y="210" width="200" height="80" rx="14" fill="#e0f2fe" stroke="#2563eb" stroke-width="2"/>
  <text x="2320" y="256" class="label" text-anchor="middle" fill="#0f172a">Rider / Driver / Web</text>
  <line x1="2160" y1="320" x2="2000" y2="470" stroke="#111827" stroke-width="3" marker-end="url(#arrowSolid)"/>
  <text x="2140" y="350" class="small" fill="#111827">HTTPS (uitgo.local)</text>

  <!-- Side mini panel: Cloud stack -->
  <rect x="2160" y="760" width="320" height="260" rx="18" fill="#f9fafb" stroke="#9ca3af" stroke-dasharray="6 6" stroke-width="2"/>
  <text x="2320" y="800" class="heading" text-anchor="middle" fill="#111827">Cloud Stack (AWS) – Non-k3s</text>
  <rect x="2200" y="820" width="240" height="140" rx="14" fill="#fff" stroke="#9ca3af" stroke-width="2"/>
  <text x="2320" y="860" class="label" text-anchor="middle" fill="#374151">AWS Application Load Balancer</text>
  <text x="2320" y="885" class="small" text-anchor="middle" fill="#6b7280">Ports 80 / 443</text>
  <text x="2320" y="915" class="small" text-anchor="middle" fill="#6b7280">Used by cloud deployment;</text>
  <text x="2320" y="940" class="small" text-anchor="middle" fill="#6b7280">local dev uses k3s + Traefik</text>

  <!-- Terraform + Kustomize card -->
  <rect x="80" y="430" width="260" height="140" rx="16" class="card" stroke="#60a5fa" stroke-width="2"/>
  <text x="210" y="465" class="heading" text-anchor="middle" fill="#1d4ed8">Terraform + Kustomize</text>
  <text x="210" y="495" class="small" text-anchor="middle" fill="#374151">Terraform: cloud infra (AWS ALB)</text>
  <text x="210" y="520" class="small" text-anchor="middle" fill="#374151">Kustomize: manifests &amp; overlays</text>

  <!-- Section labels -->
  <text x="60" y="105" class="heading" fill="#c2410c">SOURCE &amp; CI (GitHub Actions → GHCR)</text>
  <text x="60" y="445" class="heading" fill="#1d4ed8">GITOPS CD (ArgoCD → k3s local workstation)</text>
  <text x="60" y="805" class="heading" fill="#6b21a8">DATA • OBSERVABILITY • TESTING</text>

  <!-- Source & CI lane -->
  <rect x="80" y="130" width="200" height="140" rx="16" class="card" stroke="#fb923c" stroke-width="2"/>
  <text x="180" y="170" class="label" text-anchor="middle" fill="#111827">Developer</text>
  <text x="180" y="195" class="small" text-anchor="middle" fill="#6b7280">Push code</text>

  <rect x="320" y="130" width="220" height="140" rx="16" class="card" stroke="#fb923c" stroke-width="2"/>
  <text x="430" y="170" class="label" text-anchor="middle" fill="#111827">GitHub Repo</text>
  <text x="430" y="195" class="small" text-anchor="middle" fill="#6b7280">uitgo (app + infra)</text>

  <line x1="280" y1="200" x2="320" y2="200" stroke="#111827" stroke-width="3" marker-end="url(#arrowSolid)"/>

  <rect x="580" y="110" width="540" height="180" rx="18" class="card" stroke="#f97316" stroke-width="2"/>
  <text x="850" y="145" class="heading" text-anchor="middle" fill="#b91c1c">GitHub Actions: backend-cicd.yml</text>
  <text x="610" y="170" class="small" fill="#374151">1) Checkout</text>
  <text x="610" y="195" class="small" fill="#374151">2) Tests: Go test, Flutter test</text>
  <text x="610" y="220" class="small" fill="#374151">3) Static analysis: golangci-lint</text>
  <text x="610" y="245" class="small" fill="#374151">4) Build Docker images:</text>
  <text x="640" y="270" class="mono" fill="#111827">ghcr.io/&lt;owner&gt;/uitgo-user-service:&lt;tag&gt;</text>
  <text x="640" y="293" class="mono" fill="#111827">ghcr.io/&lt;owner&gt;/uitgo-trip-service:&lt;tag&gt;</text>
  <text x="640" y="316" class="mono" fill="#111827">ghcr.io/&lt;owner&gt;/uitgo-driver-service:&lt;tag&gt;</text>
  <text x="640" y="339" class="small" fill="#6b7280">Alt: ghcr.io/&lt;owner&gt;/uitgo-backend:&lt;tag&gt;</text>
  <text x="960" y="170" class="small" fill="#374151">5) Trivy image scan</text>
  <text x="960" y="195" class="small" fill="#374151">6) Aikido Security</text>
  <text x="960" y="220" class="small" fill="#374151">7) Push to GHCR</text>
  <text x="960" y="245" class="small" fill="#374151">8) Update Kustomize tags + commit</text>

  <line x1="540" y1="200" x2="580" y2="200" stroke="#111827" stroke-width="3" marker-end="url(#arrowSolid)"/>

  <rect x="1180" y="150" width="220" height="120" rx="16" class="card" stroke="#f97316" stroke-width="2"/>
  <text x="1290" y="185" class="label" text-anchor="middle" fill="#111827">GHCR</text>
  <text x="1290" y="210" class="small" text-anchor="middle" fill="#374151">ghcr.io</text>
  <text x="1290" y="235" class="small" text-anchor="middle" fill="#374151">Container Registry</text>

  <line x1="1120" y1="200" x2="1180" y2="200" stroke="#2563eb" stroke-width="3" stroke-dasharray="6 6" marker-end="url(#arrowDotted)"/>
  <text x="1150" y="180" class="small" text-anchor="middle" fill="#2563eb">Docker image</text>

  <rect x="1460" y="150" width="260" height="120" rx="16" class="card" stroke="#2563eb" stroke-width="2"/>
  <text x="1590" y="185" class="label" text-anchor="middle" fill="#111827">GitOps: Kustomize overlays</text>
  <text x="1590" y="210" class="small" text-anchor="middle" fill="#374151">Image tag bump commit</text>
  <text x="1590" y="235" class="small" text-anchor="middle" fill="#374151">Stored in GitHub repo</text>

  <line x1="1400" y1="200" x2="1460" y2="200" stroke="#2563eb" stroke-width="3" stroke-dasharray="6 6" marker-end="url(#arrowDotted)"/>
  <text x="1430" y="180" class="small" text-anchor="middle" fill="#2563eb">Kustomize tag update</text>

  <!-- GitOps CD -->
  <rect x="360" y="470" width="240" height="140" rx="16" class="card" stroke="#2563eb" stroke-width="2"/>
  <text x="480" y="510" class="label" text-anchor="middle" fill="#111827">GitOps manifests</text>
  <text x="480" y="535" class="small" text-anchor="middle" fill="#374151">Kustomize overlays</text>

  <rect x="660" y="440" width="200" height="180" rx="16" class="card" stroke="#2563eb" stroke-width="2"/>
  <text x="760" y="480" class="heading" text-anchor="middle" fill="#1d4ed8">Argo CD</text>
  <text x="760" y="505" class="small" text-anchor="middle" fill="#374151">GitOps Sync</text>

  <line x1="600" y1="520" x2="660" y2="520" stroke="#2563eb" stroke-width="3" stroke-dasharray="6 6" marker-end="url(#arrowDotted)"/>
  <text x="630" y="500" class="small" text-anchor="middle" fill="#2563eb">Git pull</text>

  <!-- k3s Cluster -->
  <rect x="920" y="430" width="840" height="300" rx="20" fill="#f8fbff" stroke="#93c5fd" stroke-width="2"/>
  <text x="1340" y="460" class="heading" text-anchor="middle" fill="#0f172a">Kubernetes Cluster: k3s (LOCAL on workstation, installed via script)</text>

  <!-- Ingress -->
  <rect x="960" y="480" width="220" height="120" rx="16" class="card" stroke="#38bdf8" stroke-width="2"/>
  <text x="1070" y="515" class="label" text-anchor="middle" fill="#0ea5e9">Traefik Ingress (k3s built-in)</text>
  <text x="1070" y="540" class="small" text-anchor="middle" fill="#374151">Host: uitgo.local</text>
  <text x="1070" y="565" class="small" text-anchor="middle" fill="#374151">Services are ClusterIP</text>

  <!-- Services -->
  <rect x="1230" y="500" width="420" height="200" rx="16" class="card" stroke="#2563eb" stroke-width="2"/>
  <text x="1440" y="535" class="heading" text-anchor="middle" fill="#1d4ed8">Go Microservices</text>
  <text x="1440" y="560" class="small" text-anchor="middle" fill="#374151">Go 1.22+ • Gin • GORM • JWT • WebSocket</text>

  <rect x="1250" y="580" width="110" height="90" rx="12" class="card" stroke="#2563eb" stroke-width="2"/>
  <text x="1305" y="615" class="small" text-anchor="middle" fill="#111827">user-service</text>
  <text x="1305" y="640" class="small" text-anchor="middle" fill="#6b7280">JWT, GORM</text>

  <rect x="1390" y="580" width="110" height="90" rx="12" class="card" stroke="#2563eb" stroke-width="2"/>
  <text x="1445" y="615" class="small" text-anchor="middle" fill="#111827">trip-service</text>
  <text x="1445" y="640" class="small" text-anchor="middle" fill="#6b7280">WebSocket</text>

  <rect x="1530" y="580" width="110" height="90" rx="12" class="card" stroke="#2563eb" stroke-width="2"/>
  <text x="1585" y="615" class="small" text-anchor="middle" fill="#111827">driver-service</text>
  <text x="1585" y="640" class="small" text-anchor="middle" fill="#6b7280">GEO, Queue</text>

  <line x1="1180" y1="540" x2="1250" y2="600" stroke="#111827" stroke-width="3" marker-end="url(#arrowSolid)"/>
  <line x1="1180" y1="540" x2="1390" y2="600" stroke="#111827" stroke-width="3" marker-end="url(#arrowSolid)"/>
  <line x1="1180" y1="540" x2="1530" y2="600" stroke="#111827" stroke-width="3" marker-end="url(#arrowSolid)"/>

  <!-- Tooling NodePort -->
  <rect x="960" y="630" width="220" height="90" rx="14" class="card" stroke="#fbbf24" stroke-width="2"/>
  <text x="1070" y="665" class="small" text-anchor="middle" fill="#92400e">Tooling via NodePort patches (local only)</text>
  <text x="1070" y="690" class="small" text-anchor="middle" fill="#6b7280">ArgoCD Server Service, Grafana Service</text>

  <!-- Storage -->
  <rect x="1680" y="480" width="260" height="180" rx="16" class="card" stroke="#a855f7" stroke-width="2"/>
  <text x="1810" y="515" class="label" text-anchor="middle" fill="#6b21a8">Storage / PVC</text>
  <rect x="1700" y="540" width="110" height="100" rx="12" fill="#f5f3ff" stroke="#8b5cf6" stroke-width="2"/>
  <text x="1755" y="575" class="small" text-anchor="middle" fill="#4c1d95">PostgreSQL 15</text>
  <text x="1755" y="600" class="small" text-anchor="middle" fill="#6b7280">StatefulSet + PVC</text>
  <rect x="1820" y="540" width="110" height="100" rx="12" fill="#f5f3ff" stroke="#8b5cf6" stroke-width="2"/>
  <text x="1875" y="575" class="small" text-anchor="middle" fill="#4c1d95">Redis 7</text>
  <text x="1875" y="600" class="small" text-anchor="middle" fill="#6b7280">cache + queue + GEO</text>

  <!-- Arrows to storage -->
  <line x1="1305" y1="670" x2="1755" y2="640" stroke="#111827" stroke-width="2.5" marker-end="url(#arrowSolid)"/>
  <line x1="1445" y1="670" x2="1755" y2="640" stroke="#111827" stroke-width="2.5" marker-end="url(#arrowSolid)"/>
  <line x1="1585" y1="670" x2="1755" y2="640" stroke="#111827" stroke-width="2.5" marker-end="url(#arrowSolid)"/>
  <line x1="1305" y1="670" x2="1875" y2="640" stroke="#111827" stroke-width="2.5" marker-end="url(#arrowSolid)"/>
  <line x1="1445" y1="670" x2="1875" y2="640" stroke="#111827" stroke-width="2.5" marker-end="url(#arrowSolid)"/>
  <line x1="1585" y1="670" x2="1875" y2="640" stroke="#111827" stroke-width="2.5" marker-end="url(#arrowSolid)"/>

  <line x1="860" y1="520" x2="960" y2="520" stroke="#2563eb" stroke-width="3" stroke-dasharray="6 6" marker-end="url(#arrowDotted)"/>
  <text x="910" y="500" class="small" text-anchor="middle" fill="#2563eb">GitOps sync</text>

  <!-- Bottom band cards -->
  <!-- Redis details -->
  <rect x="80" y="840" width="560" height="220" rx="18" class="card" stroke="#8b5cf6" stroke-width="2"/>
  <text x="360" y="875" class="heading" text-anchor="middle" fill="#6b21a8">Redis Usage</text>
  <text x="110" y="910" class="small" fill="#4c1d95">1) GEO index: GEOADD / GEOSEARCH</text>
  <text x="110" y="935" class="mono" fill="#1f2937">driver:locations + meta</text>
  <text x="110" y="965" class="small" fill="#4c1d95">2) Trip queue: RPUSH producer / BRPOP consumer</text>
  <text x="110" y="990" class="mono" fill="#1f2937">queue: trip:requests</text>
  <text x="110" y="1020" class="small" fill="#4c1d95">3) Home-feed cache</text>
  <text x="110" y="1045" class="mono" fill="#1f2937">home:promotions</text>
  <text x="300" y="1045" class="mono" fill="#1f2937">home:news:&lt;limit&gt;</text>
  <text x="110" y="1070" class="small" fill="#6b7280">No Pub/Sub or Streams in current codebase</text>

  <!-- PostgreSQL card -->
  <rect x="680" y="840" width="260" height="180" rx="18" class="card" stroke="#8b5cf6" stroke-width="2"/>
  <text x="810" y="875" class="heading" text-anchor="middle" fill="#6b21a8">PostgreSQL</text>
  <text x="810" y="905" class="small" text-anchor="middle" fill="#374151">PostgreSQL 15 – primary relational DB</text>
  <text x="810" y="930" class="small" text-anchor="middle" fill="#374151">StatefulSet + PVC</text>

  <!-- Observability -->
  <rect x="990" y="840" width="520" height="240" rx="18" class="card" stroke="#10b981" stroke-width="2"/>
  <text x="1250" y="875" class="heading" text-anchor="middle" fill="#047857">Observability</text>
  <text x="1020" y="910" class="small" fill="#065f46">Prometheus (metrics)</text>
  <text x="1020" y="935" class="small" fill="#065f46">Grafana (dashboards)</text>
  <text x="1020" y="960" class="small" fill="#065f46">Loki + Promtail (logs)</text>
  <text x="1020" y="985" class="small" fill="#065f46">Sentry (errors)</text>
  <text x="1180" y="1015" class="small" fill="#374151">Services → Prometheus (metrics)</text>
  <text x="1180" y="1040" class="small" fill="#374151">Services → Promtail → Loki (logs)</text>
  <text x="1180" y="1065" class="small" fill="#374151">Services → Sentry (errors)</text>
  <text x="1180" y="1090" class="small" fill="#374151">Grafana reads from Prometheus + Loki</text>

  <!-- Testing -->
  <rect x="1550" y="840" width="410" height="220" rx="18" class="card" stroke="#facc15" stroke-width="2"/>
  <text x="1760" y="875" class="heading" text-anchor="middle" fill="#b45309">Testing</text>
  <text x="1570" y="910" class="small" fill="#92400e">Unit/Integration: Go test</text>
  <text x="1570" y="935" class="small" fill="#92400e">UI/Widget: Flutter test</text>
  <text x="1570" y="960" class="small" fill="#92400e">Static analysis: golangci-lint</text>
  <text x="1570" y="985" class="small" fill="#92400e">Load testing: k6</text>
  <line x1="1690" y1="1000" x2="1960" y2="500" stroke="#111827" stroke-width="3" marker-end="url(#arrowSolid)"/>
  <text x="1800" y="980" class="small" fill="#111827">k6 → Traefik</text>

  <!-- Legend -->
  <rect x="2050" y="1180" width="430" height="140" rx="14" class="card" stroke="#d1d5db" stroke-width="2"/>
  <text x="2265" y="1215" class="label" text-anchor="middle" fill="#111827">Legend</text>
  <line x1="2075" y1="1245" x2="2175" y2="1245" stroke="#111827" stroke-width="3" marker-end="url(#arrowSolid)"/>
  <text x="2190" y="1250" class="small" fill="#111827">Solid = runtime traffic</text>
  <line x1="2075" y1="1280" x2="2175" y2="1280" stroke="#2563eb" stroke-width="3" stroke-dasharray="6 6" marker-end="url(#arrowDotted)"/>
  <text x="2190" y="1285" class="small" fill="#2563eb">Dotted = CI/CD &amp; GitOps</text>
</svg>
